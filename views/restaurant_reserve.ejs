<%- include('parts/html-head') %>
<%- include('parts/navbar') %>

<article>
    <div class="container" style="height: 800px ; word-break: break-all; margin: 10px auto 10px auto;">

        <% for(let i of rows) { %>

        <div class="card" style="width: 80% ; margin: 10% auto;">
            <div id="infobar" class="alert alert-success" role="alert" style="display: none">
            </div>
            <form method="" name="form1" onsubmit="return checkForm()" style="margin-left: 5%; margin-top: 5%;">

                <div class="form-group">
                    <label for="item">項目</label><br>
                    <select name="item" id="item">
                        <option value="<%= i.restaurant_title %>"><%= i.restaurant_title %></option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="date">日期</label>
                    <input type="date" class="form-control" id="date" name="date" style="width: 30%;">
                </div>

                <button type="submit" class="btn btn-primary">送出</button>
            </form>
            <div class="card-body">
                <h1><%= i.restaurant_title %></h1>
                <figure style="float: left; margin-right: 3%;">
                    <img src=/img/r<%= i.restaurant_NO %>.jpg alt="" style="width: 100%; height: 100%;">
                </figure>
                <p><%= i.restaurant_content %></p>
            </div>
        </div>

        <% } %>
    </div>
</article>



<%- include('parts/scripts') %>
<script>
    
    function checkForm() {
        // Ajax
        $.post('/restaurant_reserve', $(document.form1).serialize(), function (data) {
            console.log(data);

            if (data.success) {
                $('#infobar').text('新增成功');
                $('#infobar').removeClass('alert-danger').addClass('alert-success');
                setTimeout(function () {
                    location.href = '/';
                }, 3000)
            } else {
                $('#infobar').text(data.error || '新增失敗');
                $('#infobar').removeClass('alert-success').addClass('alert-danger');
                setTimeout(function () {
                    $('#infobar').slideUp();
                }, 3000)
            }
            $('#infobar').slideDown();
        }, 'json');
        return false; // 阻斷轉跳
    }
</script>
<%- include('parts/html-foot') %>